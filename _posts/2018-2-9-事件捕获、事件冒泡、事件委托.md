---
layout:     post
title:      "事件捕获、事件冒泡、事件委托详解"
subtitle:   "事件js中不可或缺的一个部分，这篇文章就对这些问题做一个详细的说明"
date:       2018-02-09
author:     "cl"
header-img: "img/home-bg-o.jpg"
tags:
    - 前端开发
    - DOM
---
# 前言
最近在练习vue的相关实例，第一个实例当中我看到了e.target，一度不知所云，便趁此机会将事件复习了一遍。这篇博文不会对事件的具体API进行详细说明，而是将事件冒泡、事件捕获、事件委托这3者进行详细的说明。事不宜迟，我们马上开始吧。

## 事件冒泡
> 时间开始时由最具体的元素（文档中嵌套层次最深的那个节点）接受，然后逐次向上传播到较为不具体的节点（文档）


简而言之，事件触发的顺序回想泡泡一样从底部向上升至顶部结束。

## 事件捕获
> 不太具体的节点应该更早地接受到事件，而最具体的节点应该最后接受到事件，即向下发生。

看到这里其实觉得事件冒泡、事件捕获的概念也不是很难理解。那我们就跟深入一下；下图来自w3c官网上，清晰地解释了DOM事件流的发生顺序：

![](/img/in-post/DOM/eventflow.svg)

图中我们可以看到DOM事件的发生是先事件捕获，再事件冒泡的。

## 事件委托

事件冒泡、事件捕获是DOM中的基础，接下来我们就来看一下事件委托是怎么回事。
> 事件委托利用了事件冒泡，只指定一个事件处理程序，就可以管理某一类型的所有事件。

上面的话听起来是不是觉得十分晦涩，查阅网上大牛的概括，我觉得收快递的例子十分不错，希望对大家有帮助：


有三个同事预计会在周一收到快递。为签收快递，有两种办法：一是三个人在公司门口等快递；二是委托给前台MM代为签收。现实当中，我们大都采用委托的方案（公司也不会容忍那么多员工站在门口就为了等快递）。前台MM收到快递后，她会判断收件人是谁，然后按照收件人的要求签收，甚至代为付款。这种方案还有一个优势，那就是即使公司里来了新员工（不管多少），前台MM也会在收到寄给新员工的快递后核实并代为签收。

这里其实还有2层意思的：

第一，现在委托前台的同事是可以代为签收的，即程序中的现有的dom节点是有事件的；

第二，新员工也是可以被前台MM代为签收的，即程序中新添加的dom节点也是有事件的。

有了一个印象，我们再来一些代码加深一下记忆

《js》高程中的例子十分具体，在此我也不找其他的例子了。
``` html
<ul id="myLinks">
    <li id="goSomewhere">Go Somewhere</li>
    <li id="doSomething">Do Something</li>
    <li id="sayHi">Say hi</li>
</ul>
```
```javascript
var item1=document.getElementById("goSomewhere");
var item2=document.getElementById("doSomething");
var item3=document.getElementById("sayHi");

EventUtil.addHandler(item1,"click",function(event){
    location.href="http://www.baidu.com";
});
EventUtil.addHandler(item2,"click",function(event){
    document.title="I love js";
});
EventUtil.addHandler(item3,"click",function(event){
    alert('hi');
});
```
观察以上代码，我们可以发现代码量多不说，对DOM的操作多了，那么浏览器需要重建DOM树的次数也会增多，无疑会影响到性能。这时候就要轮到事件委托出场了。
```javascript
var list=document.getElementById("myLinks");
EventUtil.addHandler(list,"click",function(event){
    event=EventUtil.getEvent(event);
    var target=EventUtil.getTarget(event);
    switch(target.id){
        case "goSomewhere":
            document.title="I love js";
            break;
        case "doSomething":
            location.href="http://www.baidu.com";
            break;
        case "sayHi":
            alert("hi!");
            break;
    }
});
```
观察以上代码，我们可以发现只对“ul”元素添加了点击事件，前面我们提到事件委托事件建立在事件冒泡的基础上的，当我们点击其中一个“li”的时候，由于事件冒泡的关系，“li”的事件会上浮至“ul”，此时我们就可以调用“ul”的点击事件来判断需要处理哪一个了。相比上面的未使用事件委托的是不是提升了好多呢？

## 适合事件委托的事件
click,mousedown,mouseup,keydown,keyup,keypress;
mouseover与mouseout事件也冒泡，但因为需要计算元素的位置便不太容易了。

## 查阅资料
[js中的事件委托或是事件代理详解--博客园](https://www.cnblogs.com/liugang-vip/p/5616484.html)

[W3c Event UI](https://www.w3.org/TR/DOM-Level-3-Events/#dom-event-architecture)


