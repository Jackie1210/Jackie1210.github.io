---
layout:     post
title:      "社交网站开发踩坑记录"
subtitle:   "踩坑记录"
date:       2018-06-17
author:     "cl"
header-img: "img/home-bg-o.jpg"
tags:
    - 社交网站项目
---

## 前言
这片博客会着重记录我在开发社交网站中遇到的一些问题，为以后的高效开发提供借鉴。

## axios向后端发送POST请求失败。
axios是一个promise包装的访问后端API的非常有效的工具。在这次的项目中，我也遇到了问题。为了方便
说明，我还是举个栗子来说明：
```js
praise(itemBlogId){
  let postData={
    blog_id:itemBlogId
  };
  this.$axios({
    method:'post',
    url:'/add_praise/',
    data:postData
  }).then(res=>{
    // window.location="./";
    console.log(res.data.msg);
    window.location="./";
  }).catch(err=>{
    console.log(err.msg);
  })
},
```
上面的一个点赞操作需要完成当点赞的时候返回后端进行数据更新的操作，所以我们还是采用post的方式，但
是当我向上面那样写了之后，数据始终无法更新到后端的数据库中去，这个坑也踩了好久，最后终于解决了。原来，
使用post传递数据的时候，content-type是默认为text/plain的，但是后端默认的content-type是
form-data，这时候就使用qs模块对数据进行序列化，最后就可以讲其适应我们后端的数据了。修改如下：
```js
praise(itemBlogId){
  let postData=this.$qs.stringify({
    blog_id:itemBlogId
  });
  this.$axios({
    method:'post',
    url:'/add_praise/',
    data:postData
  }).then(res=>{
    // window.location="./";
    console.log(res.data.msg);
    window.location="./";
  }).catch(err=>{
    console.log(err.msg);
  })
},
```

## 数据的缓存
为了实现我初次登录之后用户名可以保存在浏览器中，而不用每次都需要访问后端服务器进行操作，我采用了
cookie的方式进行存储。通过这种方式，我可以将需要动态展示的数据保存在浏览器当中，从而可以进行全局
展示。
![](/img/in-post/snspro/cookiestore.png)
之所以采用这种方式进行存储，是借鉴了b站，stackoverflow；但是他们都是保存了一个用户的UID，而不是向我username，passowrd暴露在浏览器内存中，可见我的这种做法很不安全，后期还需要进行进一步修改。

## vue列表点赞
这个场景的坑主要是体现在点赞，评论这个场景当中，当我们需要对某一条微博进行点赞操作的时候，因为vue的v-for的缘故，对某一条进行点击事件的绑定，就会牵一发而动全身。一个思路是引入jquery对dom进行操作，但是这就违背了vue数据驱动的初衷了。后来采用的解决方案如下：
```vue
<template>
...
<div class="button-item">
  <div class="t" @click="praise(item.pk)" :data-id="item.fields.pk">
    <icon class="icon" name="thumbs-up" :class="{praised:justify(item.pk)}"></icon>
    <span class="number" v-model="item.fields.pra_num">{{item.fields.pra_num}}</span>
  </div>
</div>
...
</template>
<script>
justify(blogid){
  let list=this.pra_list;
  for(let key of list){
    if(key.pk===blogid){
      return true;
    }
  }
  return false;
},
</script>
```
但是这种做法的一大弊端就是每次操作之后，我都要进行页面刷新才能讲数据反映在数据当中，所以我的想法是，后面可不可以用vuex的方式，当钱用户已经点赞的列表保存在vuex中，当数据有更新的时候也会自动更新到vuex中，而页面中的值也会通过mapgetter来自动更新。

## 尽量不要使用a标签
<code>a</code>标签有超链接的意味，所以在数据需要进行跳转操作的时候会跳转到一个页面，而数据不会进行更新，而且这个问题你可能很难发现，所以为了解决这个问题，我还是建议使用div+cursor：pointer进行“小手”样式的展示。

##未完待续


