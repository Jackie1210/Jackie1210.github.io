---
layout:     post
title:      "Yours电商网站技术总结"
subtitle:   "几经波折，一个电商网站也算搭建完成了，这篇文章旨在对项目中学到的知识进行一个总结"
date:       2018-02-26
author:     "cl"
header-img: "img/home-bg-o.jpg"
tags:
    - 前端开发
    - 项目总结
---
- [前言](#前言)
- [项目整体架构](#项目整体架构)
- [技术选型](#技术选型)
- [webpack](#简述webpack)
- [模块目录](#模块目录)

## 前言
Yours电商网站(前端部分)搭建也算我个人的一个比较大的项目了，也算是将之前学过的html，css，javascript技术用到了实处，那么这篇文章将会对我开发过程中遇到的问题与学到的知识进行一个汇总，也可以算是一个经验的积累。那么，事不宜迟，我们就开始吧！

## 项目整体架构
此Yours电商网站是一个课程的前端部分，后端已经提供好了接口。总的来说，前端部分总共分为显示层，逻辑层，服务端层。显示层用来显示页面；逻辑层用来提供在一个页面中进行操作所要用到的事件与具体的函数；服务端层则用来从本地域向服务端层获取数据之用。

## 技术选型
这个电商项目是由多个页面，样式及js组成的，所以在开发的过程中我们选用了webpack打包工具，同时使用jquery来对dom进行操作，鉴于笔者尚未实践过前端三大框架(vue，react，ng)，所以先把自己能做的做好吧。在进入正式的模块功能实现之前，我们先来回顾一下webpack在这个项目中起到的作用。

### 简述webpack
其实webpack是一款十分实用的打包工具，尤其其配合nodejs的打包器npm，提供了相当多的包共你处理。你只需要定义一个入口文件，并定义输出目录即可完成。如下代码片段：
```javascript
	entry: {
        'common'            : ['./src/page/common/index.js'],
        'index'             : ['./src/page/index/index.js'],
        'list'              : ['./src/page/list/index.js'],
        'detail'            : ['./src/page/detail/index.js'],
        'cart'              : ['./src/page/cart/index.js'],
        'order-confirm'     : ['./src/page/order-confirm/index.js'],
        'order-list'        : ['./src/page/order-list/index.js'],
        'order-detail'      : ['./src/page/order-detail/index.js'],
        'payment'           : ['./src/page/payment/index.js'],
        'user-login'        : ['./src/page/user-login/index.js'],
        'user-register'     : ['./src/page/user-register/index.js'],
        'user-pass-reset'   : ['./src/page/user-pass-reset/index.js'],
        'user-center'       : ['./src/page/user-center/index.js'],
        'user-center-update': ['./src/page/user-center-update/index.js'],
        'user-pass-update'  : ['./src/page/user-pass-update/index.js'],
        'result'            : ['./src/page/result/index.js'],
    },
    output: {
        path: './dist',
        publicPath : '/dist',
        filename: 'js/[name].js'
    }
```
### 多入口页面配置----htmlWebpackPlugin
通过new一个htmlWebpackPlugin,将入口文件打包到指定的位置以及指定的名字，从而实现多入口也能对应指定的html。其中获取htmlWebpackPlugin参数则可以通过一个函数生成，webpack提供了许多属性，在这次项目中我们主要用到了以下几个：
- inject：设置为true表示将文件放在body元素的末尾，可以进行性能优化。
- hash：为所有注入的静态文件设定一个唯一的hash值
- chunks：将公共要用的文件添加到文件中
### 目标文件分类分开存放
new ExtractTextPlugin("css/[name].css")即将css文件单独存放

如下则是将通用模块单独存放
```javascript
new webpack.optimize.CommonsChunkPlugin({
    name : 'common',
    filename : 'js/base.js'
}),
```
### externals
引入第三方库而不将其打包，本项目便是在这里引入jquery

### 热更新
webpack-dev-server的引入使得我们可以在修改文件之后而在浏览器里面自动更新，极大提高了我们的开发效率。

### js工具类的封装
在本项目中，工具类js均保存在util文件夹中，mm.js提供了一系列基本操作用到的函数。其中有个十分实用的包hogan，hogan是一种非常简单的模板引擎，用 Hogan 渲染 html 模板不用操作 dom 会更方便。简单来说，一个页面一般包含3个文件----index.js,index.css,index.string。此时，index.string中的内容就是将要插入起对应页面待开发的核心内容，其余部分按需从layout中提取相应的组件。渲染html时采用先编译再渲染的方式。常用语法如下
- {{data}}转义的变量
- {{{data}}}不转义的变量
- {{#list}}{{/list}}列表循环/真值判断
- {{^list}}{{/list}}空列表/非真值判断
- {{.}}枚举当前元素
- {{!}}注释

## 模块目录
- [用户模块](#用户模块)
- [商品模块](#商品模块)
- [购物车模块](#购物车模块)
- [订单模块](#订单模块)
- [支付模块](#支付模块)
- [问题与解决](#需要注意的问题)
- [性能优化](#性能优化)


## 用户模块
### 登录
登录页面相对较为简单，需要的就是调用mm.js对输入字段进行验证，如果错误则返回错误的信息。
### 注册
注册部分与登录不同的地方就在于注册需要对表单的输入进行异步验证，如假设你输入的邮箱地址不正确的话，就要即时的提示你。//可以优化
### 找回密码
本页的逻辑是输入账号，成功则回调当初设定的问题，输入问题答案后进行后端验证，成功后则提示你重制你的密码。
### 个人中心
本页逻辑主要是渲染页面。
### 修改密码
修改模块的逻辑与找回密码的类似，都是先进性字段验证再调用后端的借口来进行相应的回调。
## 商品模块
### 网站首页
商品首页没有什么好说的，无非就是组件的堆砌，以及css的书写。需要注意的就是元素居中：margin：0 auto以及要注意清除浮动，即子元素float布局，父元素需要overflow：hidden来清除浮动，否则将会造成布局bug。后期在优化的过程中建议拿flex&grid来尝试一下。
### 商品列表页
商品列表页的主要逻辑就是设置一系列页面中需要的值之后，调用后端的list来进行渲染，那么这其中的一个小难点就是加载分页信息了。
### 商品详情页
商品的详情页一方面是对商品进行一个展示，其次就是在选择商品数量的时候判断“+要判断是否小于最大值，-要判断是否小于最小值”。加入购物车的时候只需要调用后端接口，成功后则挑战成功加入购物车的页面。
## 购物车模块
- 购物车商品的展示
- 修改购物车的商品数量
- 选中/取消选中购物车中的商品
- 全选/取消全选购物车中的商品
- 删除单个/多个购物车商品
- 购物车结算

这一模块的代码大部分都是调用后台对应的接口，来对页面进行渲染，需要注意的就是在购物车中有商品删除之后对应的导航条中的数字也要进行修改。
## 订单模块
### 订单列表页
逻辑与商品列表的类似。
### 订单确认页
这一模块主要分为以下几个模块：收货地址，商品清单展示。其中最重要的就是对地址的一些列操作了，收货地址的添加，删除操作，编辑操作也与之前页面中获取元素从后端调用相应的方法，成功了则重新加载商品清单。
### 订单详情页
这一模块主要就是对页面的渲染进行操作，与之前的页面渲染也是大同小异。
## 支付模块
这一模块就是从后端调用订单号对应的二维码，并渲染页面。需要注意的是在这一模块当中我们还加了一个监听订单状态的，即每隔5s查看状态是否生效，不生效则继续调用后端的信息。

## 需要注意的问题
### this
本项目中使用了许多的闭包，那么这势必会导致一个问题，那就是this的指向不明确，采用的方法就是在闭包的外面加上var _this=this,这样闭包内部就可以调用父函数的闭包了。

### 阻止时间冒泡
这在添加地址那一块出现过，即点击地址输入界面的空白区域也会关闭地址编辑(本来只有点击地址编辑的外部区域才会关闭地址编辑)。原因就是事件冒泡引起的，解决办法就是在地址编辑框的容器的最接近上层的元素，使用event.stopPropagation().

### 前端跨域
本项目中使用jquery自带的ajax函数进行网络请求，缺点是只能调用同源下的数据，所以还要使用chaeles来进行跨域。今后在学习了promise之后有时间会试试用promise进行异步调用的效果。

## 性能优化
### 减少闭包
闭包导致占用了大量的内存，不利于网页的运行，虽然现在还只是一个小网页，考虑到大的电商网站的大流量，这是一个不可忽视的地方。

### 尝试使用css siprits
商城中有许多的图片，可以尝试将零星的图片放在一张图里，减少对页面的http请求

### 压缩图片，与文件大小
### 减少DOM操作
本项目使用的是jquery，但我认为jquery是对DOM的丰富，所以对DOM的操作数量也是可想而知的，尤其是当流量增多起来的时候。今后可以考虑使用三大框架来进行进一步的性能优化。